{"ast":null,"code":"import { switchMap, tap } from 'rxjs';\nimport { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./comentarios.service\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"@angular/common\";\nimport * as i4 from \"../../../componentes/mensagem/mensagem.component\";\n\nfunction ComentariosComponent_div_0_li_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵelementStart(1, \"p\", 10);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"em\");\n    i0.ɵɵtext(4);\n    i0.ɵɵpipe(5, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 11);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const comentario_r4 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", comentario_r4.userName, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(5, 3, comentario_r4.date, \"dd-MM-yyyy HH:mm\"));\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(comentario_r4.text);\n  }\n}\n\nfunction ComentariosComponent_div_0_app_mensagem_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"app-mensagem\", 12);\n  }\n\n  if (rf & 2) {\n    i0.ɵɵproperty(\"mensagem\", \"Tamanho de 300 caracteres\");\n  }\n}\n\nfunction ComentariosComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵelementStart(1, \"div\");\n    i0.ɵɵelementStart(2, \"ul\", 1);\n    i0.ɵɵtemplate(3, ComentariosComponent_div_0_li_3_Template, 8, 6, \"li\", 2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 3);\n    i0.ɵɵelementStart(5, \"form\", 4);\n    i0.ɵɵlistener(\"submit\", function ComentariosComponent_div_0_Template_form_submit_5_listener() {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return ctx_r5.gravar();\n    });\n    i0.ɵɵelementStart(6, \"div\", 5);\n    i0.ɵɵelement(7, \"textarea\", 6);\n    i0.ɵɵelementStart(8, \"div\", 7);\n    i0.ɵɵelementStart(9, \"button\", 8);\n    i0.ɵɵtext(10, \" Publicar \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(11, ComentariosComponent_div_0_app_mensagem_11_Template, 1, 1, \"app-mensagem\", 9);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const comentarios_r1 = ctx.ngIf;\n    const ctx_r0 = i0.ɵɵnextContext();\n    let tmp_3_0;\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", comentarios_r1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"formGroup\", ctx_r0.comentarioForm);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.comentarioForm.invalid);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !!((tmp_3_0 = ctx_r0.comentarioForm.get(\"comentario\")) == null ? null : tmp_3_0.errors == null ? null : tmp_3_0.errors[\"maxLength\"]));\n  }\n}\n\nexport class ComentariosComponent {\n  constructor(comentarioService, formBuilder) {\n    this.comentarioService = comentarioService;\n    this.formBuilder = formBuilder;\n  }\n\n  ngOnInit() {\n    this.comentarios$ = this.comentarioService.buscaComentario(this.animalId);\n    this.comentarioForm = this.formBuilder.group({\n      comentario: ['', Validators.maxLength(300)]\n    });\n  }\n\n  gravar() {\n    var _a, _b;\n\n    const comentario = (_b = (_a = this.comentarioForm.get('comentario')) === null || _a === void 0 ? void 0 : _a.value) !== null && _b !== void 0 ? _b : '';\n    this.comentarios$ = this.comentarioService.incluiComentario(this.animalId, comentario).pipe(switchMap(() => this.comentarioService.buscaComentario(this.animalId)), tap(() => {\n      this.comentarioForm.reset();\n      alert('Salvo Comentario');\n    }));\n    /*\r\n        Primeiro eu preciso pegar o texto do comentário, comentario = this.comentarioForm.get(‘comentario’).\r\n      Como eu não sei se tem ou não valor, eu vou utilizar o safe navigation .value. E se não tiver valor, interrogação dupla, é vazio,\r\n      não tem comentário nenhum.\r\n        E vamos fazer aqui um this.comentarios, porque no momento em que ele confirmar, a página tem que ser recarregada,\r\n      então o comentário tem que pegar a nova informação que acabamos de incluir. Vamos manipular isso utilizando o RxJS.\r\n        Vamos fazer o seguinte, this.comentarios$ = this.comentariosService.incluiComentario(this.id, comentario);.\r\n      Só que ele está reclamando que eu quero um observable de comentários, não de comentário. Como nós vamos fazer essa manipulação?\r\n      Vamos utilizar o comando pipe e os operadores do RxJS.\r\n        Esse incluiComentario eu vou fazer .pipe() e vamos, como vimos nas aulas passadas, utilizar um operador chamado switchMap para convertermos o fluxo.\r\n      O fluxo está vindo de inclusão, eu quero convertê-lo para o fluxo de buscar os comentários do servidor.\r\n        Aqui vamos utilizar o operador (switchMap()). E esse operador tem que retornar, então =>, uma arrow function dentro do switchMap,\r\n      ele vai retornar o this.comentariosService.buscaComentario(this.id). Então eu converti, ele até pode reclamar, o comentário está lá.\r\n        Só que além de fazer o switchMap, nós precisamos resetar o formulário. E como fazemos isso? Para fazer o que chamamos de efeitos colaterais,\r\n      ou seja, coisas que não vão influenciar o fluxo, mas precisam acontecer durante o processamento desse fluxo, nós podemos utilizar o operador chamado tap.\r\n      Então aqui, depois do switchMap, ele vai fazer o switchMap e depois ele vai fazer o tap().\r\n        Esse tap vai fazer uma função, só que o que estiver dentro dessa função não influencia no fluxo do RxJS.\r\n      Então eu vou vir aqui no tap() e colocar => this.comentarioForm.reset();, eu vou resetar e eu vou fazer um alert falando que o comentário\r\n      foi salvo, (‘Salvo Comentário’);.\r\n      */\n  }\n\n}\n\nComentariosComponent.ɵfac = function ComentariosComponent_Factory(t) {\n  return new (t || ComentariosComponent)(i0.ɵɵdirectiveInject(i1.ComentariosService), i0.ɵɵdirectiveInject(i2.FormBuilder));\n};\n\nComentariosComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ComentariosComponent,\n  selectors: [[\"app-comentarios\"]],\n  inputs: {\n    animalId: \"animalId\"\n  },\n  decls: 2,\n  vars: 3,\n  consts: [[4, \"ngIf\"], [1, \"list-unstyled\"], [4, \"ngFor\", \"ngForOf\"], [1, \"mt-4\"], [3, \"formGroup\", \"submit\"], [1, \"input-group\"], [\"formControlName\", \"comentario\", 1, \"form-control\"], [1, \"input-group-append\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", \"pull-left\", 3, \"disabled\"], [3, \"mensagem\", 4, \"ngIf\"], [1, \"text-dark\", \"font-weight-bold\", \"mr-1\"], [1, \"break-word\", \"mb-2\"], [3, \"mensagem\"]],\n  template: function ComentariosComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, ComentariosComponent_div_0_Template, 12, 4, \"div\", 0);\n      i0.ɵɵpipe(1, \"async\");\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(1, 1, ctx.comentarios$));\n    }\n  },\n  directives: [i3.NgIf, i3.NgForOf, i2.ɵNgNoValidate, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.DefaultValueAccessor, i2.NgControlStatus, i2.FormControlName, i4.MensagemComponent],\n  pipes: [i3.AsyncPipe, i3.DatePipe],\n  styles: [\".comentario-list[_ngcontent-%COMP%] {\\r\\n  height: 50vh;\\r\\n  overflow-y: auto;\\r\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbWVudGFyaW9zLmNvbXBvbmVudC5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxZQUFZO0VBQ1osZ0JBQWdCO0FBQ2xCIiwiZmlsZSI6ImNvbWVudGFyaW9zLmNvbXBvbmVudC5jc3MiLCJzb3VyY2VzQ29udGVudCI6WyIuY29tZW50YXJpby1saXN0IHtcclxuICBoZWlnaHQ6IDUwdmg7XHJcbiAgb3ZlcmZsb3cteTogYXV0bztcclxufVxyXG4iXX0= */\"]\n});","map":{"version":3,"sources":["C:/ProgramaAceleracao/programaaceleracao/Projetos/angular_formularios-main/gatitobook/src/app/animais/detalhe-animal/comentarios/comentarios.component.ts"],"names":["switchMap","tap","Validators","i0","i1","i2","i3","i4","ComentariosComponent_div_0_li_3_Template","rf","ctx","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","ɵɵpipe","comentario_r4","$implicit","ɵɵadvance","ɵɵtextInterpolate1","userName","ɵɵtextInterpolate","ɵɵpipeBind2","date","text","ComentariosComponent_div_0_app_mensagem_11_Template","ɵɵelement","ɵɵproperty","ComentariosComponent_div_0_Template","_r6","ɵɵgetCurrentView","ɵɵtemplate","ɵɵlistener","ComentariosComponent_div_0_Template_form_submit_5_listener","ɵɵrestoreView","ctx_r5","ɵɵnextContext","gravar","comentarios_r1","ngIf","ctx_r0","tmp_3_0","comentarioForm","invalid","get","errors","ComentariosComponent","constructor","comentarioService","formBuilder","ngOnInit","comentarios$","buscaComentario","animalId","group","comentario","maxLength","_a","_b","value","incluiComentario","pipe","reset","alert","ɵfac","ComentariosComponent_Factory","t","ɵɵdirectiveInject","ComentariosService","FormBuilder","ɵcmp","ɵɵdefineComponent","type","selectors","inputs","decls","vars","consts","template","ComentariosComponent_Template","ɵɵpipeBind1","directives","NgIf","NgForOf","ɵNgNoValidate","NgControlStatusGroup","FormGroupDirective","DefaultValueAccessor","NgControlStatus","FormControlName","MensagemComponent","pipes","AsyncPipe","DatePipe","styles"],"mappings":"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","sourcesContent":["import { switchMap, tap } from 'rxjs';\r\nimport { Validators } from '@angular/forms';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"./comentarios.service\";\r\nimport * as i2 from \"@angular/forms\";\r\nimport * as i3 from \"@angular/common\";\r\nimport * as i4 from \"../../../componentes/mensagem/mensagem.component\";\r\nfunction ComentariosComponent_div_0_li_3_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"li\");\r\n    i0.ɵɵelementStart(1, \"p\", 10);\r\n    i0.ɵɵtext(2);\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementStart(3, \"em\");\r\n    i0.ɵɵtext(4);\r\n    i0.ɵɵpipe(5, \"date\");\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementStart(6, \"p\", 11);\r\n    i0.ɵɵtext(7);\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const comentario_r4 = ctx.$implicit;\r\n    i0.ɵɵadvance(2);\r\n    i0.ɵɵtextInterpolate1(\" \", comentario_r4.userName, \" \");\r\n    i0.ɵɵadvance(2);\r\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(5, 3, comentario_r4.date, \"dd-MM-yyyy HH:mm\"));\r\n    i0.ɵɵadvance(3);\r\n    i0.ɵɵtextInterpolate(comentario_r4.text);\r\n} }\r\nfunction ComentariosComponent_div_0_app_mensagem_11_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelement(0, \"app-mensagem\", 12);\r\n} if (rf & 2) {\r\n    i0.ɵɵproperty(\"mensagem\", \"Tamanho de 300 caracteres\");\r\n} }\r\nfunction ComentariosComponent_div_0_Template(rf, ctx) { if (rf & 1) {\r\n    const _r6 = i0.ɵɵgetCurrentView();\r\n    i0.ɵɵelementStart(0, \"div\");\r\n    i0.ɵɵelementStart(1, \"div\");\r\n    i0.ɵɵelementStart(2, \"ul\", 1);\r\n    i0.ɵɵtemplate(3, ComentariosComponent_div_0_li_3_Template, 8, 6, \"li\", 2);\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementStart(4, \"div\", 3);\r\n    i0.ɵɵelementStart(5, \"form\", 4);\r\n    i0.ɵɵlistener(\"submit\", function ComentariosComponent_div_0_Template_form_submit_5_listener() { i0.ɵɵrestoreView(_r6); const ctx_r5 = i0.ɵɵnextContext(); return ctx_r5.gravar(); });\r\n    i0.ɵɵelementStart(6, \"div\", 5);\r\n    i0.ɵɵelement(7, \"textarea\", 6);\r\n    i0.ɵɵelementStart(8, \"div\", 7);\r\n    i0.ɵɵelementStart(9, \"button\", 8);\r\n    i0.ɵɵtext(10, \" Publicar \");\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵtemplate(11, ComentariosComponent_div_0_app_mensagem_11_Template, 1, 1, \"app-mensagem\", 9);\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementEnd();\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const comentarios_r1 = ctx.ngIf;\r\n    const ctx_r0 = i0.ɵɵnextContext();\r\n    let tmp_3_0;\r\n    i0.ɵɵadvance(3);\r\n    i0.ɵɵproperty(\"ngForOf\", comentarios_r1);\r\n    i0.ɵɵadvance(2);\r\n    i0.ɵɵproperty(\"formGroup\", ctx_r0.comentarioForm);\r\n    i0.ɵɵadvance(4);\r\n    i0.ɵɵproperty(\"disabled\", ctx_r0.comentarioForm.invalid);\r\n    i0.ɵɵadvance(2);\r\n    i0.ɵɵproperty(\"ngIf\", !!((tmp_3_0 = ctx_r0.comentarioForm.get(\"comentario\")) == null ? null : tmp_3_0.errors == null ? null : tmp_3_0.errors[\"maxLength\"]));\r\n} }\r\nexport class ComentariosComponent {\r\n    constructor(comentarioService, formBuilder) {\r\n        this.comentarioService = comentarioService;\r\n        this.formBuilder = formBuilder;\r\n    }\r\n    ngOnInit() {\r\n        this.comentarios$ = this.comentarioService.buscaComentario(this.animalId);\r\n        this.comentarioForm = this.formBuilder.group({\r\n            comentario: ['', Validators.maxLength(300)],\r\n        });\r\n    }\r\n    gravar() {\r\n        var _a, _b;\r\n        const comentario = (_b = (_a = this.comentarioForm.get('comentario')) === null || _a === void 0 ? void 0 : _a.value) !== null && _b !== void 0 ? _b : '';\r\n        this.comentarios$ = this.comentarioService\r\n            .incluiComentario(this.animalId, comentario)\r\n            .pipe(switchMap(() => this.comentarioService.buscaComentario(this.animalId)), tap(() => {\r\n            this.comentarioForm.reset();\r\n            alert('Salvo Comentario');\r\n        }));\r\n        /*\r\n  \r\n        Primeiro eu preciso pegar o texto do comentário, comentario = this.comentarioForm.get(‘comentario’).\r\n          Como eu não sei se tem ou não valor, eu vou utilizar o safe navigation .value. E se não tiver valor, interrogação dupla, é vazio,\r\n          não tem comentário nenhum.\r\n  \r\n        E vamos fazer aqui um this.comentarios, porque no momento em que ele confirmar, a página tem que ser recarregada,\r\n          então o comentário tem que pegar a nova informação que acabamos de incluir. Vamos manipular isso utilizando o RxJS.\r\n  \r\n        Vamos fazer o seguinte, this.comentarios$ = this.comentariosService.incluiComentario(this.id, comentario);.\r\n          Só que ele está reclamando que eu quero um observable de comentários, não de comentário. Como nós vamos fazer essa manipulação?\r\n          Vamos utilizar o comando pipe e os operadores do RxJS.\r\n  \r\n        Esse incluiComentario eu vou fazer .pipe() e vamos, como vimos nas aulas passadas, utilizar um operador chamado switchMap para convertermos o fluxo.\r\n          O fluxo está vindo de inclusão, eu quero convertê-lo para o fluxo de buscar os comentários do servidor.\r\n  \r\n        Aqui vamos utilizar o operador (switchMap()). E esse operador tem que retornar, então =>, uma arrow function dentro do switchMap,\r\n          ele vai retornar o this.comentariosService.buscaComentario(this.id). Então eu converti, ele até pode reclamar, o comentário está lá.\r\n  \r\n        Só que além de fazer o switchMap, nós precisamos resetar o formulário. E como fazemos isso? Para fazer o que chamamos de efeitos colaterais,\r\n          ou seja, coisas que não vão influenciar o fluxo, mas precisam acontecer durante o processamento desse fluxo, nós podemos utilizar o operador chamado tap.\r\n          Então aqui, depois do switchMap, ele vai fazer o switchMap e depois ele vai fazer o tap().\r\n  \r\n        Esse tap vai fazer uma função, só que o que estiver dentro dessa função não influencia no fluxo do RxJS.\r\n          Então eu vou vir aqui no tap() e colocar => this.comentarioForm.reset();, eu vou resetar e eu vou fazer um alert falando que o comentário\r\n          foi salvo, (‘Salvo Comentário’);.\r\n  \r\n      */\r\n    }\r\n}\r\nComentariosComponent.ɵfac = function ComentariosComponent_Factory(t) { return new (t || ComentariosComponent)(i0.ɵɵdirectiveInject(i1.ComentariosService), i0.ɵɵdirectiveInject(i2.FormBuilder)); };\r\nComentariosComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: ComentariosComponent, selectors: [[\"app-comentarios\"]], inputs: { animalId: \"animalId\" }, decls: 2, vars: 3, consts: [[4, \"ngIf\"], [1, \"list-unstyled\"], [4, \"ngFor\", \"ngForOf\"], [1, \"mt-4\"], [3, \"formGroup\", \"submit\"], [1, \"input-group\"], [\"formControlName\", \"comentario\", 1, \"form-control\"], [1, \"input-group-append\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", \"pull-left\", 3, \"disabled\"], [3, \"mensagem\", 4, \"ngIf\"], [1, \"text-dark\", \"font-weight-bold\", \"mr-1\"], [1, \"break-word\", \"mb-2\"], [3, \"mensagem\"]], template: function ComentariosComponent_Template(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵtemplate(0, ComentariosComponent_div_0_Template, 12, 4, \"div\", 0);\r\n        i0.ɵɵpipe(1, \"async\");\r\n    } if (rf & 2) {\r\n        i0.ɵɵproperty(\"ngIf\", i0.ɵɵpipeBind1(1, 1, ctx.comentarios$));\r\n    } }, directives: [i3.NgIf, i3.NgForOf, i2.ɵNgNoValidate, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.DefaultValueAccessor, i2.NgControlStatus, i2.FormControlName, i4.MensagemComponent], pipes: [i3.AsyncPipe, i3.DatePipe], styles: [\".comentario-list[_ngcontent-%COMP%] {\\r\\n  height: 50vh;\\r\\n  overflow-y: auto;\\r\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImNvbWVudGFyaW9zLmNvbXBvbmVudC5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDRSxZQUFZO0VBQ1osZ0JBQWdCO0FBQ2xCIiwiZmlsZSI6ImNvbWVudGFyaW9zLmNvbXBvbmVudC5jc3MiLCJzb3VyY2VzQ29udGVudCI6WyIuY29tZW50YXJpby1saXN0IHtcclxuICBoZWlnaHQ6IDUwdmg7XHJcbiAgb3ZlcmZsb3cteTogYXV0bztcclxufVxyXG4iXX0= */\"] });\r\n"]},"metadata":{},"sourceType":"module"}